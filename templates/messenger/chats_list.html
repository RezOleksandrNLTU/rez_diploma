<div class="flex-col items-stretch w-4/12 ml-2 border-r-2 pr-2 border-slate-400">
    {% include 'messenger/header.html' %}
    <div class="flex flex-col">
        <script>
            let chat_photo_div;
            let generated_chat_photo;
            let generated_chat_photo_background;
        </script>
        {% for listed_chat in chats %}
            <div class="my-1 w-full">
                <div class="flex flex-col items-center justify-center w-full">
                    <a href="{% url 'chat_content' chat_id=listed_chat.id %}" class="bg-slate-200 w-full p-2 shadow-md rounded">
                        <div class="flex items-center border-gray-700">
    {#                           <img src="https://cdn.tuk.dev/assets/components/misc/doge-coin.png" alt="coin avatar" class="w-12 h-12 rounded-full" />#}
                            <div class="flex items-start justify-between w-full">
                                <div class="w-full flex">
                                    <div id="chat_photo_div_{{ listed_chat.id }}">
                                        {% if listed_chat.photo %}
                                            <img src="{{ listed_chat.photo }}" alt="{{ listed_chat.name.0 }}" class="self-end shrink-0 mr-3 w-10 h-10 relative flex justify-center items-center rounded-full"/>
                                        {% else %}
                                            <script>
                                                chat_photo_div = document.getElementById('chat_photo_div_{{ listed_chat.id }}');
                                                generated_chat_photo = document.createElement('div');
                                                generated_chat_photo_background = stringToColour('{{ listed_chat.name }}');
                                                generated_chat_photo.className = `mr-3 w-10 h-10 relative flex justify-center items-center rounded-full text-xl text-white uppercase bg-[${generated_chat_photo_background}]`;
                                                generated_chat_photo.innerHTML = '{{ listed_chat.name.0 }}';
                                                chat_photo_div.appendChild(generated_chat_photo);
                                            </script>
                                        {% endif %}
                                    </div>
                                    <div>
                                        <p class="focus:outline-none text-l font-medium leading-5 text-gray-800 ">{{ listed_chat.name }}</p>
                                        <p class="focus:outline-none text-xs leading-normal pt-1 text-gray-500 text-slate-700">{{ listed_chat.users|length }} members</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        {% endfor %}

        <div class="my-1 w-full">
            <div class="flex flex-col items-center justify-center w-full">
                <div class="bg-slate-200 w-full p-2 shadow-md rounded flex items-center border-gray-700">
                    <div class="flex items-start justify-between w-full">
                        <div class="w-full flex">
                            <div class="inline w-full flex">
                                <form method="post" name="create-chat" class="inline w-full">
                                    {% csrf_token %}
                                    <input class="rounded float-left p-2 mr-2" type="text" name="name" placeholder="Chat name">
                                    <button type="submit" class="float-right inline-flex items-center px-4 py-2 w-fit border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-100">Create chat</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $('form[name="create-chat"]').submit(function(e) {
        e.preventDefault();
        let users_list = [{{ user.id }}];
        $.ajax({
                url: '{% url 'chat-list' %}',
                type: 'POST',
                data: $(this).serialize() + '&users=' + users_list,
                success: function(data) {
                    window.location.href = '{% url 'home'%}';
                }
            });
        }
    );
</script>